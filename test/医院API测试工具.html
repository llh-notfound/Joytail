<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŒ»é™¢APIæµ‹è¯•å·¥å…·</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .status {
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            border-left: 4px solid;
        }
        .success { 
            background: #d4edda; 
            color: #155724; 
            border-color: #28a745;
        }
        .error { 
            background: #f8d7da; 
            color: #721c24; 
            border-color: #dc3545;
        }
        .warning { 
            background: #fff3cd; 
            color: #856404; 
            border-color: #ffc107;
        }
        .info { 
            background: #d1ecf1; 
            color: #0c5460; 
            border-color: #17a2b8;
        }
        pre { 
            background: #f8f9fa; 
            padding: 15px; 
            border-radius: 6px; 
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        button { 
            background: #007bff; 
            color: white; 
            border: none; 
            padding: 12px 24px; 
            border-radius: 6px; 
            cursor: pointer; 
            margin: 10px 5px 0 0;
            font-size: 14px;
        }
        button:hover { background: #0056b3; }
        button:disabled { 
            background: #6c757d; 
            cursor: not-allowed; 
        }
        .test-config {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            align-items: center;
        }
        .test-config label {
            font-weight: 500;
        }
        .test-config select, .test-config input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .hospital-card {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
            background: #f8f9fa;
        }
        .hospital-name {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        .hospital-info {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¥ åŒ»é™¢APIæµ‹è¯•å·¥å…·</h1>
        
        <div class="status info">
            <strong>æµ‹è¯•ç›®çš„ï¼š</strong>éªŒè¯åŒ»é™¢æ¨¡å—APIæ˜¯å¦æŒ‰ç…§æ–‡æ¡£æ­£ç¡®å®ç°
        </div>

        <div class="test-config">
            <label>APIæœåŠ¡å™¨:</label>
            <select id="serverSelect">
                <option value="http://localhost:8080/api">æœ¬åœ°å¼€å‘æœåŠ¡å™¨ (localhost:8080)</option>
                <option value="https://udrvmlsoncfg.sealosbja.site/api">çº¿ä¸ŠæœåŠ¡å™¨</option>
            </select>
            
            <label>åŒ»é™¢ID:</label>
            <input type="number" id="hospitalId" value="1" min="1" max="10">
        </div>

        <div>
            <button onclick="testHospitalList()">æµ‹è¯•åŒ»é™¢åˆ—è¡¨API</button>
            <button onclick="testHospitalDetail()">æµ‹è¯•åŒ»é™¢è¯¦æƒ…API</button>
            <button onclick="testBothAPIs()">å®Œæ•´æµ‹è¯•</button>
            <button onclick="clearResults()">æ¸…ç©ºç»“æœ</button>
        </div>

        <div id="results"></div>
    </div>

    <script>
        const resultsDiv = document.getElementById('results');
        
        function getBaseUrl() {
            return document.getElementById('serverSelect').value;
        }
        
        function getHospitalId() {
            return document.getElementById('hospitalId').value;
        }
        
        function addResult(type, title, content) {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = `<strong>${title}</strong><br>${content}`;
            resultsDiv.appendChild(div);
            div.scrollIntoView({ behavior: 'smooth' });
        }
        
        function clearResults() {
            resultsDiv.innerHTML = '';
        }
        
        async function testHospitalList() {
            const baseUrl = getBaseUrl();
            const url = `${baseUrl}/medical/hospitals`;
            
            addResult('info', 'ğŸ” å¼€å§‹æµ‹è¯•åŒ»é™¢åˆ—è¡¨API', `è¯·æ±‚URL: ${url}`);
            
            try {
                const startTime = Date.now();
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                });
                const responseTime = Date.now() - startTime;
                
                addResult('info', 'ğŸ“¡ è¯·æ±‚å‘é€æˆåŠŸ', `çŠ¶æ€ç : ${response.status}, å“åº”æ—¶é—´: ${responseTime}ms`);
                
                if (response.ok) {
                    const data = await response.json();
                    
                    // éªŒè¯å“åº”æ ¼å¼
                    if (data.code === 200 && data.data && data.data.list) {
                        addResult('success', 'âœ… åŒ»é™¢åˆ—è¡¨APIæµ‹è¯•æˆåŠŸ', 
                            `è¿”å› ${data.data.list.length} ä¸ªåŒ»é™¢, æ€»æ•°: ${data.data.total || data.data.list.length}`);
                        
                        // æ˜¾ç¤ºåŒ»é™¢ä¿¡æ¯
                        let hospitalInfo = '<div style="margin-top: 15px;"><strong>åŒ»é™¢åˆ—è¡¨:</strong></div>';
                        data.data.list.forEach((hospital, index) => {
                            hospitalInfo += `
                                <div class="hospital-card">
                                    <div class="hospital-name">${hospital.name || 'æœªçŸ¥åŒ»é™¢'}</div>
                                    <div class="hospital-info">ID: ${hospital.id}</div>
                                    <div class="hospital-info">åœ°å€: ${hospital.address || 'æœªæä¾›'}</div>
                                    <div class="hospital-info">ç”µè¯: ${hospital.phone || 'æœªæä¾›'}</div>
                                    <div class="hospital-info">ç½‘ç«™: ${hospital.website || 'æœªæä¾›'}</div>
                                    <div class="hospital-info">è¯„åˆ†: ${hospital.rating || 'æœªè¯„åˆ†'}</div>
                                    <div class="hospital-info">24å°æ—¶æ€¥è¯Š: ${hospital.emergency_24h ? 'æ˜¯' : 'å¦'}</div>
                                </div>
                            `;
                        });
                        addResult('info', 'ğŸ“‹ åŒ»é™¢æ•°æ®è¯¦æƒ…', hospitalInfo);
                        
                        // éªŒè¯æ•°æ®å®Œæ•´æ€§
                        const requiredFields = ['id', 'name', 'address', 'phone'];
                        const missingFields = [];
                        data.data.list.forEach((hospital, index) => {
                            requiredFields.forEach(field => {
                                if (!hospital[field]) {
                                    missingFields.push(`åŒ»é™¢${index + 1}ç¼ºå°‘å­—æ®µ: ${field}`);
                                }
                            });
                        });
                        
                        if (missingFields.length > 0) {
                            addResult('warning', 'âš ï¸ æ•°æ®å®Œæ•´æ€§æ£€æŸ¥', missingFields.join('<br>'));
                        } else {
                            addResult('success', 'âœ… æ•°æ®å®Œæ•´æ€§æ£€æŸ¥é€šè¿‡', 'æ‰€æœ‰å¿…å¡«å­—æ®µéƒ½å­˜åœ¨');
                        }
                        
                    } else {
                        addResult('error', 'âŒ APIå“åº”æ ¼å¼é”™è¯¯', 
                            `æœŸæœ›: {code: 200, data: {list: [...]}}<br>å®é™…: <pre>${JSON.stringify(data, null, 2)}</pre>`);
                    }
                    
                } else {
                    const errorText = await response.text();
                    addResult('error', 'âŒ HTTPè¯·æ±‚å¤±è´¥', 
                        `çŠ¶æ€ç : ${response.status}<br>é”™è¯¯ä¿¡æ¯: ${errorText}`);
                }
                
            } catch (error) {
                addResult('error', 'âŒ ç½‘ç»œè¯·æ±‚å¤±è´¥', 
                    `é”™è¯¯ç±»å‹: ${error.name}<br>é”™è¯¯ä¿¡æ¯: ${error.message}<br><br>å¯èƒ½çš„åŸå› :<br>
                    â€¢ æœåŠ¡å™¨æœªå¯åŠ¨<br>
                    â€¢ ç«¯å£é…ç½®é”™è¯¯<br>
                    â€¢ ç½‘ç»œè¿æ¥é—®é¢˜<br>
                    â€¢ CORSè·¨åŸŸé—®é¢˜`);
            }
        }
        
        async function testHospitalDetail() {
            const baseUrl = getBaseUrl();
            const hospitalId = getHospitalId();
            const url = `${baseUrl}/medical/hospitals/${hospitalId}`;
            
            addResult('info', 'ğŸ” å¼€å§‹æµ‹è¯•åŒ»é™¢è¯¦æƒ…API', `è¯·æ±‚URL: ${url}`);
            
            try {
                const startTime = Date.now();
                const response = await fetch(url, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    }
                });
                const responseTime = Date.now() - startTime;
                
                addResult('info', 'ğŸ“¡ è¯·æ±‚å‘é€æˆåŠŸ', `çŠ¶æ€ç : ${response.status}, å“åº”æ—¶é—´: ${responseTime}ms`);
                
                if (response.status === 200) {
                    const data = await response.json();
                    
                    if (data.code === 200 && data.data) {
                        const hospital = data.data;
                        addResult('success', 'âœ… åŒ»é™¢è¯¦æƒ…APIæµ‹è¯•æˆåŠŸ', `æˆåŠŸè·å–åŒ»é™¢: ${hospital.name}`);
                        
                        // æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
                        let detailInfo = `
                            <div class="hospital-card">
                                <div class="hospital-name">${hospital.name}</div>
                                <div class="hospital-info">ID: ${hospital.id}</div>
                                <div class="hospital-info">åœ°å€: ${hospital.address}</div>
                                <div class="hospital-info">ç”µè¯: ${hospital.phone}</div>
                                <div class="hospital-info">ç½‘ç«™: ${hospital.website || 'æœªæä¾›'}</div>
                                <div class="hospital-info">Logo: ${hospital.logo_url ? 'å·²æä¾›' : 'æœªæä¾›'}</div>
                                <div class="hospital-info">å°é¢å›¾: ${hospital.cover_url ? 'å·²æä¾›' : 'æœªæä¾›'}</div>
                                <div class="hospital-info">ç¯å¢ƒå›¾ç‰‡: ${hospital.images ? hospital.images.length : 0} å¼ </div>
                                <div class="hospital-info">æœåŠ¡é¡¹ç›®: ${hospital.services ? hospital.services.length : 0} é¡¹</div>
                                <div class="hospital-info">åŒ»ç”Ÿå›¢é˜Ÿ: ${hospital.doctors ? hospital.doctors.length : 0} äºº</div>
                                <div class="hospital-info">è¯„åˆ†: ${hospital.rating || 'æœªè¯„åˆ†'}</div>
                                <div class="hospital-info">è¥ä¸šæ—¶é—´: ${hospital.business_hours || 'æœªæä¾›'}</div>
                                <div class="hospital-info">24å°æ—¶æ€¥è¯Š: ${hospital.emergency_24h ? 'æ˜¯' : 'å¦'}</div>
                                <div class="hospital-info">åœè½¦ä½: ${hospital.parking ? 'æœ‰' : 'æ— /æœªçŸ¥'}</div>
                                <div class="hospital-info">WiFi: ${hospital.wifi ? 'æœ‰' : 'æ— /æœªçŸ¥'}</div>
                            </div>
                        `;
                        addResult('info', 'ğŸ“‹ åŒ»é™¢è¯¦æƒ…æ•°æ®', detailInfo);
                        
                        // æ˜¾ç¤ºæè¿°
                        if (hospital.description) {
                            addResult('info', 'ğŸ“ åŒ»é™¢æè¿°', `<pre>${hospital.description}</pre>`);
                        }
                        
                    } else if (data.code === 404) {
                        addResult('warning', 'âš ï¸ åŒ»é™¢ä¸å­˜åœ¨', `åŒ»é™¢ID ${hospitalId} ä¸å­˜åœ¨ï¼Œè¿™æ˜¯æ­£å¸¸çš„404å“åº”`);
                    } else {
                        addResult('error', 'âŒ APIå“åº”æ ¼å¼é”™è¯¯', 
                            `æœŸæœ›: {code: 200, data: {...}}<br>å®é™…: <pre>${JSON.stringify(data, null, 2)}</pre>`);
                    }
                    
                } else if (response.status === 404) {
                    const data = await response.json();
                    addResult('warning', 'âš ï¸ åŒ»é™¢ä¸å­˜åœ¨', 
                        `åŒ»é™¢ID ${hospitalId} ä¸å­˜åœ¨<br>å“åº”: <pre>${JSON.stringify(data, null, 2)}</pre>`);
                } else {
                    const errorText = await response.text();
                    addResult('error', 'âŒ HTTPè¯·æ±‚å¤±è´¥', 
                        `çŠ¶æ€ç : ${response.status}<br>é”™è¯¯ä¿¡æ¯: ${errorText}`);
                }
                
            } catch (error) {
                addResult('error', 'âŒ ç½‘ç»œè¯·æ±‚å¤±è´¥', 
                    `é”™è¯¯ç±»å‹: ${error.name}<br>é”™è¯¯ä¿¡æ¯: ${error.message}`);
            }
        }
        
        async function testBothAPIs() {
            addResult('info', 'ğŸš€ å¼€å§‹å®Œæ•´APIæµ‹è¯•', 'æ­£åœ¨æµ‹è¯•åŒ»é™¢åˆ—è¡¨å’Œè¯¦æƒ…API...');
            
            await testHospitalList();
            await new Promise(resolve => setTimeout(resolve, 1000)); // ç­‰å¾…1ç§’
            await testHospitalDetail();
            
            addResult('success', 'âœ… å®Œæ•´æµ‹è¯•å®Œæˆ', 'è¯·æŸ¥çœ‹ä¸Šæ–¹æµ‹è¯•ç»“æœ');
        }
        
        // é¡µé¢åŠ è½½æ—¶çš„è¯´æ˜
        window.addEventListener('load', () => {
            addResult('info', 'ğŸš€ åŒ»é™¢APIæµ‹è¯•å·¥å…·å·²å°±ç»ª', `
                <strong>æµ‹è¯•è¯´æ˜:</strong><br>
                â€¢ ç¡®ä¿åç«¯æœåŠ¡å™¨å·²å¯åŠ¨<br>
                â€¢ æ ¹æ®APIæ–‡æ¡£ï¼ŒåŒ»é™¢åˆ—è¡¨æ¥å£åº”è¿”å›3ä¸ªåŒ»é™¢<br>
                â€¢ åŒ»é™¢è¯¦æƒ…æ¥å£åº”åŒ…å«å®Œæ•´çš„åŒ»é™¢ä¿¡æ¯<br>
                â€¢ å¯ä»¥åˆ‡æ¢ä¸åŒçš„æœåŠ¡å™¨åœ°å€è¿›è¡Œæµ‹è¯•<br><br>
                <strong>APIæ–‡æ¡£è¦æ±‚:</strong><br>
                â€¢ åˆ—è¡¨æ¥å£: GET /api/medical/hospitals<br>
                â€¢ è¯¦æƒ…æ¥å£: GET /api/medical/hospitals/{id}<br>
                â€¢ å“åº”æ ¼å¼: {code: 200, message: "è·å–æˆåŠŸ", data: {...}}
            `);
        });
    </script>
</body>
</html>
