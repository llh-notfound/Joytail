# PetPal ç¤¾åŒºå‘å¸ƒåŠŸèƒ½é—®é¢˜åˆ†ææŠ¥å‘Š

## ğŸ“‹ é—®é¢˜æè¿°
ç”¨æˆ·åé¦ˆï¼šå‘å¸ƒå¸–å­åæ— æ³•çœ‹åˆ°è‡ªå·±å‘å¸ƒçš„å†…å®¹ï¼Œä½†APIè¯·æ±‚æ˜¾ç¤ºæˆåŠŸï¼ˆPOST 200 OKï¼‰ã€‚

## ğŸ” é—®é¢˜åˆ†æ

### 1. APIè°ƒç”¨æµç¨‹æ£€æŸ¥

#### å‘å¸ƒæ¥å£ (POST /community/posts)
- âœ… è¯·æ±‚æˆåŠŸï¼šä»æˆªå›¾çœ‹åˆ° POST 200 OK
- âœ… è¯·æ±‚ä½“ï¼šåŒ…å«contentã€imagesã€tagsç­‰å¿…è¦å­—æ®µ
- âœ… è®¤è¯ï¼šè¯·æ±‚åŒ…å«Authorization header

#### è·å–åˆ—è¡¨æ¥å£ (GET /community/posts)
- ğŸ“‹ æ¨èåˆ—è¡¨ï¼š`type=recommend`
- ğŸ“‹ æœ€æ–°åˆ—è¡¨ï¼š`type=latest`  
- ğŸ”„ åˆ†é¡µï¼š`page=1, pageSize=10`

### 2. å¯èƒ½çš„é—®é¢˜åŸå› 

#### A. åç«¯æ•°æ®åº“å†™å…¥é—®é¢˜
```
å‘å¸ƒAPIè¿”å›200ï¼Œä½†æ•°æ®æœªçœŸæ­£å†™å…¥æ•°æ®åº“
- äº‹åŠ¡å›æ»š
- æ•°æ®éªŒè¯å¤±è´¥
- å¼‚æ­¥å†™å…¥å»¶è¿Ÿ
```

#### B. æ•°æ®å½’å±é—®é¢˜  
```
å¸–å­å†™å…¥æˆåŠŸï¼Œä½†ç”¨æˆ·å…³è”é”™è¯¯
- Tokenè§£æé”™è¯¯
- ç”¨æˆ·IDæ˜ å°„é—®é¢˜
- æƒé™æ ¡éªŒå¼‚å¸¸
```

#### C. æŸ¥è¯¢é€»è¾‘é—®é¢˜
```
æ•°æ®å†™å…¥æ­£å¸¸ï¼Œä½†æŸ¥è¯¢æ—¶æœªè¿”å›
- æŸ¥è¯¢æ¡ä»¶è¿‡æ»¤æ‰äº†æ–°å¸–å­
- æ’åºè§„åˆ™é—®é¢˜ï¼ˆæ—¶é—´æˆ³æ ¼å¼ï¼‰
- åˆ†é¡µé€»è¾‘é”™è¯¯
```

#### D. å‰ç«¯æ•°æ®åˆ·æ–°é—®é¢˜
```
åç«¯æ­£å¸¸ï¼Œä½†å‰ç«¯æœªåˆ·æ–°
- ç¼“å­˜æœªæ¸…é™¤
- åˆ—è¡¨æœªé‡æ–°è¯·æ±‚
- çŠ¶æ€ç®¡ç†é”™è¯¯
```

### 3. è¯Šæ–­æ­¥éª¤

#### æ­¥éª¤1ï¼šéªŒè¯åç«¯æ•°æ®å†™å…¥
```bash
# æ£€æŸ¥æ•°æ®åº“ä¸­æ˜¯å¦æœ‰æ–°è®°å½•
SELECT * FROM community_posts 
WHERE created_at > NOW() - INTERVAL 1 HOUR 
ORDER BY created_at DESC;
```

#### æ­¥éª¤2ï¼šéªŒè¯ç”¨æˆ·å…³è”
```bash
# æ£€æŸ¥å¸–å­çš„ç”¨æˆ·IDæ˜¯å¦æ­£ç¡®
SELECT id, user_id, content, created_at 
FROM community_posts 
WHERE user_id = 'current_user_id'
ORDER BY created_at DESC;
```

#### æ­¥éª¤3ï¼šéªŒè¯APIå“åº”æ ¼å¼
```javascript
// æ£€æŸ¥å‘å¸ƒæ¥å£è¿”å›çš„æ•°æ®æ ¼å¼
{
  "code": 200,
  "message": "success",
  "data": {
    "id": "post_123456",        // æ–°å¸–å­ID
    "userId": "user_789",       // å‘å¸ƒè€…ID
    "content": "å¸–å­å†…å®¹",      // å†…å®¹
    "createdAt": "2025-07-14T10:30:00Z"
  }
}
```

#### æ­¥éª¤4ï¼šéªŒè¯æŸ¥è¯¢æ¥å£
```javascript
// æ£€æŸ¥è·å–åˆ—è¡¨æ—¶çš„æŸ¥è¯¢å‚æ•°å’Œè¿”å›ç»“æœ
GET /api/community/posts?type=latest&page=1&pageSize=10

{
  "code": 200,
  "message": "success", 
  "data": {
    "list": [...],              // å¸–å­åˆ—è¡¨
    "total": 100,               // æ€»æ•°
    "hasMore": true             // æ˜¯å¦æœ‰æ›´å¤š
  }
}
```

### 4. ä¿®å¤å»ºè®®

#### å‰ç«¯ä¼˜åŒ–
1. **å‘å¸ƒæˆåŠŸåå¼ºåˆ¶åˆ·æ–°åˆ—è¡¨**
```javascript
// åœ¨publish.vueä¸­å‘å¸ƒæˆåŠŸå
if (response && response.code === 200) {
  // æˆåŠŸæç¤º
  uni.showToast({ title: 'å‘å¸ƒæˆåŠŸ', icon: 'success' });
  
  // é€šçŸ¥å…¶ä»–é¡µé¢åˆ·æ–°æ•°æ®
  uni.$emit('refreshCommunityList');
  
  // è¿”å›ä¸Šä¸€é¡µ
  setTimeout(() => {
    uni.navigateBack();
  }, 1500);
}
```

2. **åœ¨home.vueä¸­ç›‘å¬åˆ·æ–°äº‹ä»¶**
```javascript
// åœ¨home.vueçš„onMountedä¸­
uni.$on('refreshCommunityList', () => {
  // é‡ç½®åˆ†é¡µå¹¶åˆ·æ–°æ•°æ®
  page.value = 1;
  contentList.value = [];
  getContentList();
});
```

3. **æ·»åŠ å‘å¸ƒçŠ¶æ€è·Ÿè¸ª**
```javascript
// åœ¨å‘å¸ƒæ—¶ä¿å­˜å¸–å­IDï¼Œç”¨äºéªŒè¯
const publishPost = async () => {
  const response = await api.community.publishPost(data);
  if (response && response.code === 200) {
    // ä¿å­˜æ–°å‘å¸ƒçš„å¸–å­ID
    const newPostId = response.data.id;
    uni.setStorageSync('lastPublishedPost', newPostId);
  }
};
```

#### åç«¯ä¼˜åŒ–å»ºè®®
1. **å¢å¼ºå‘å¸ƒæ¥å£è¿”å›ä¿¡æ¯**
```json
{
  "code": 200,
  "message": "å‘å¸ƒæˆåŠŸ",
  "data": {
    "id": "post_123456",
    "status": "published",
    "visibility": "public",
    "createdAt": "2025-07-14T10:30:00Z",
    "url": "/community/detail?id=post_123456"
  }
}
```

2. **ä¼˜åŒ–æŸ¥è¯¢é€»è¾‘**
```sql
-- ç¡®ä¿æ–°å‘å¸ƒçš„å¸–å­èƒ½ç«‹å³åœ¨åˆ—è¡¨ä¸­æ˜¾ç¤º
SELECT * FROM community_posts 
WHERE status = 'published' 
  AND visibility = 'public'
ORDER BY 
  CASE WHEN type = 'latest' THEN created_at END DESC,
  CASE WHEN type = 'recommend' THEN 
    (likes_count * 0.6 + comments_count * 0.3 + created_at * 0.1) 
  END DESC
LIMIT ?, ?;
```

### 5. æµ‹è¯•éªŒè¯æ–¹æ¡ˆ

#### ä½¿ç”¨è°ƒè¯•å·¥å…·
1. æ‰“å¼€ `community-post-debug.html`
2. æ‰§è¡Œå®Œæ•´çš„å‘å¸ƒ-éªŒè¯æµç¨‹
3. æŸ¥çœ‹æ•°æ®åŒæ­¥ç»“æœ

#### æ‰‹åŠ¨éªŒè¯æ­¥éª¤
1. å‘å¸ƒä¸€ä¸ªæµ‹è¯•å¸–å­
2. ç«‹å³æ£€æŸ¥"æˆ‘çš„å‘å¸ƒ"é¡µé¢
3. æ£€æŸ¥é¦–é¡µ"æœ€æ–°"åˆ—è¡¨
4. æ£€æŸ¥é¦–é¡µ"æ¨è"åˆ—è¡¨
5. è®°å½•æ¯ä¸ªæ­¥éª¤çš„ç»“æœ

### 6. é¢„æœŸç»“æœ
âœ… **æ­£å¸¸æƒ…å†µä¸‹åº”è¯¥çœ‹åˆ°ï¼š**
- å‘å¸ƒæˆåŠŸåï¼Œå¸–å­ç«‹å³å‡ºç°åœ¨"æˆ‘çš„å‘å¸ƒ"ä¸­
- å¸–å­å‡ºç°åœ¨é¦–é¡µ"æœ€æ–°"åˆ—è¡¨çš„é¡¶éƒ¨
- æ ¹æ®äº’åŠ¨æƒ…å†µï¼Œå¸–å­å¯èƒ½å‡ºç°åœ¨"æ¨è"åˆ—è¡¨ä¸­

âŒ **å¦‚æœä»æœ‰é—®é¢˜ï¼Œå¯èƒ½éœ€è¦ï¼š**
- æ£€æŸ¥åç«¯æ•°æ®åº“é…ç½®
- éªŒè¯ç”¨æˆ·è®¤è¯æµç¨‹
- ä¼˜åŒ–å‰ç«¯æ•°æ®åˆ·æ–°æœºåˆ¶
- æ·»åŠ æ›´è¯¦ç»†çš„é”™è¯¯æ—¥å¿—

## ğŸ› ï¸ ç«‹å³æ‰§è¡Œçš„ä¿®å¤æ–¹æ¡ˆ

åŸºäºå½“å‰ä»£ç åˆ†æï¼Œæˆ‘å»ºè®®ç«‹å³å®æ–½ä»¥ä¸‹ä¿®å¤ï¼š
